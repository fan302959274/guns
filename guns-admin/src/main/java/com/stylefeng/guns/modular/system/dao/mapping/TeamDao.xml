<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.stylefeng.guns.modular.system.dao.TeamDao">

    <sql id="Base_Column_List">
        a.id, name, membernum, winnum, debtnum, drawnum,point,prov,city,teamdesc,ownerid,status,createdate,updatedate
    </sql>

    <select id="selectTeams" resultType="map">
        select
        <include refid="Base_Column_List" />,
        (
        CASE
        WHEN  a.area  = 1  THEN '南京'
        WHEN  a.area  = 2  THEN '合肥'
        END
        ) "area"
        ,(
        CASE
        WHEN a.level = 1  THEN '使者'
        WHEN a.level = 2  THEN '守卫'
        WHEN a.level = 3  THEN '战士'
        WHEN a.level = 4  THEN '统治'
        WHEN a.level = 5  THEN '经典'
        WHEN a.level = 6  THEN '传奇'
        WHEN a.level = 7  THEN '神灵'
        END
        ) "level"
        from pk_team a
        LEFT  JOIN  areas  b  ON   a.area =b.areaid
        <if test="name != null">
            where name like CONCAT('%',#{name},'%')
        </if>
        ORDER  BY a.id DESC

    </select>

    <select id="selectTeamsMembers" resultType="map">
        select
        a.id as  id ,b.name as name,
        (
        CASE
        WHEN b.type = 1  THEN
        '队长'
        ELSE
        '队员'
        END
        ) "status",
        (
        CASE
        WHEN b.position = 1  THEN '前锋'
        WHEN b.position = 2  THEN '后卫'
        WHEN b.position = 3  THEN '中场'
        WHEN b.position = 4  THEN '门将'
        END
        ) "position",
        (
        CASE
        WHEN a.status = 1  THEN
        '审核通过'
        ELSE
        '待审核'
        END
        ) "cstauts"
        from pk_team_member a
        INNER  JOIN   pk_member  b ON  b.id=a.memberid
        <if test="teamId != null">
            where a.teamid =${teamId}
        </if>
    </select>

    <select id="getTeamInfo" resultType="map">
        select
        b.id,b.name,d.area, b.area as areaid
        from

        <if test="type == 1">
             pk_team b
             LEFT  JOIN  areas d ON d.areaid = b.area
            <if test="memberId != null">
                where b.ownerid =#{memberId}
            </if>
        </if>
        <if test="type == 2">
            pk_team_member a
            INNER  JOIN  pk_team b ON  a.teamid= b.id
            LEFT  JOIN  areas d ON d.areaid = b.area
            <if test="memberId != null">
                where a.memberid =#{memberId}
            </if>
        </if>

    </select>

    <select id="getAreaInfos" resultType="map">
        select
       a.areaid,a.area
        from  areas a
    </select>

    <delete id="deleteTeamMembers" >
        DELETE FROM pk_team_member WHERE teamid = #{teamId}
    </delete>


</mapper>