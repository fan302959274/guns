<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.stylefeng.guns.modular.system.dao.MatchDao">
    <sql id="Base_Column_List">
        t.id,
        t.no,
        tm.name as challengeteam,
        tm2.name as hostteam,
        area.area,
        park.pkname as parkname,
        park.pkaddr as pkaddr,
        (CASE
        WHEN t.status = 1 THEN
        '匹配中'
        WHEN t.status = 2 THEN
        '待比赛'
        WHEN t.status = 3 THEN
        '约战中'
        WHEN t.status = 4 THEN
        '约战完成'
        ELSE
        '未知'
        END)
        as status,
        t.date,
        t.createdate,
        me.name as meName,
        me.mobile as meMobile,
        me2.name as me2Name,
        me2.mobile as me2Mobile,
        d.name as time,
        o1.no as o1No,
        tm.culture as challengeculture,
        tm.ontime as challengeontime,
        tm.friendly as challengefriendly,
         (CASE
        WHEN o1.status  = '0' THEN
        '未支付'
        WHEN o1.status  = '1' THEN
        '已支付'
        ELSE
        '未支付'
        END)
        as challengepaystatus,
        o2.no as o2No,
        tm2.culture as hostculture,
        tm2.ontime as hostontime,
        tm2.friendly as hostfriendly,
        (CASE
        WHEN o2.status  = '0' THEN
        '未支付'
        WHEN o2.status  = '1' THEN
        '已支付'
        ELSE
        '未支付'
        END)
        as hostpaystatus
    </sql>

    <sql id="Base_Column_List2">
        t.id,
        t.no,
        tm.name as challengeteam,
        tm.culture as challengeculture,
        tm.ontime as challengeontime,
        tm.friendly as challengefriendly,
        tm2.name as hostteam,
        tm2.culture as hostculture,
        tm2.ontime as hostontime,
        tm2.friendly as hostfriendly,
        area.area,
        park.pkname as parkname,
        park.pkaddr as pkaddr,
        (CASE
        WHEN t.status = 1 THEN
        '匹配中'
        WHEN t.status = 2 THEN
        '待比赛'
        WHEN t.status = 3 THEN
        '约战中'
        WHEN t.status = 4 THEN
        '约战完成'
        ELSE
        '未知'
        END)
        as status,
        t.date,
        t.createdate,
        me.name as meName,
        me.mobile as meMobile,
        d.name as time
    </sql>

    <select id="selects" resultType="map">
        SELECT
        <include refid="Base_Column_List2"/>
        FROM pk_match t
        LEFT JOIN pk_team tm ON t.challengeteamid = tm.id
        LEFT JOIN pk_team tm2 ON t.hostteamid = tm2.id
        LEFT JOIN pk_park park ON t.parkid = park.id
        LEFT JOIN areas area ON park.area = area.id
        LEFT JOIN pk_member me ON t.initiatorid = me.id
        LEFT JOIN dict d on t.time = d.id


        where 1=1
        <if test="areas != null and areas != ''">
            AND area.id=#{areas}
        </if>
        <if test="pkstatus != null and pkstatus != ''">
            AND t.status=#{pkstatus}
        </if>
        <if test="hostname != null and hostname != ''">
            AND tm2.NAME like CONCAT('%',#{hostname},'%')
        </if>
        <if test="no != null and no != ''">
            AND t.no=#{no}
        </if>
        LIMIT #{start}, #{size}
    </select>

    <select id="selectById" resultType="map">
        SELECT
        <include refid="Base_Column_List"/>
        FROM pk_match t LEFT JOIN pk_team tm ON t.challengeteamid = tm.id
        LEFT JOIN pk_team tm2 ON t.hostteamid = tm2.id
        LEFT JOIN pk_park park ON t.parkid = park.id
        LEFT JOIN areas area ON park.area = area.id
        LEFT JOIN pk_member me ON t.initiatorid = me.id
        LEFT JOIN pk_member me2 ON tm.ownerid = me2.id
        LEFT JOIN dict d on t.time = d.id
        LEFT JOIN pk_order o1 on (o1.matchid = t.id and o1.teamid = t.hostteamid)
        LEFT JOIN pk_order o2 on (o2.matchid = t.id and o2.teamid = t.challengeteamid)

        where t.id=#{id}
    </select>


</mapper>