<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.stylefeng.guns.modular.system.dao.OrderDao">
    <sql id="Base_Column_List">
        o.id,
        o.no,
        (CASE
        WHEN o.status  = '0' THEN
        '未支付'
        WHEN o.status  = '1' THEN
        '已支付'
        ELSE
        '未支付'
        END)
        as paystatus,
        tm.name as challengeteam,
        tm2.name as hostteam,
        area.area,
        park.pkname as parkname,
        park.pkaddr as pkaddr,
         (CASE
        WHEN m.`status` = 1 THEN
        '匹配中'
        WHEN m.`status` = 2 THEN
        '待比赛'
        WHEN m.`status` = 3 THEN
        '约战中'
        WHEN m.`status` = 4 THEN
        '约战完成'
        ELSE
        '未知'
        END)
        as status,
        m.date,
        CONCAT(pr.start,'-',pr.end) as time,
        d.name as time
    </sql>

    <select id="selects" resultType="map">
        SELECT
        <include refid="Base_Column_List"/>
        from pk_order o
        left join pk_match m on o.matchid = m.id
        LEFT JOIN pk_team tm ON m.challengeteamid = tm.id
        LEFT JOIN pk_team tm2 ON m.hostteamid = tm2.id
        LEFT JOIN pk_park park ON m.parkid = park.id
        LEFT JOIN areas area ON m.area = area.areaid
        LEFT JOIN dict d on m.time = d.id
        LEFT JOIN pk_park_relation pr on m.time = pr.id
        where 1=1
        <if test="areas != null and areas != ''">
            AND area.id=#{areas}
        </if>
        <if test="parks != null and parks != ''">
            AND park.id=#{parks}
        </if>
        <if test="pkstatus != null and pkstatus != ''">
            AND m.status=#{pkstatus}
        </if>
        <if test="hostname != null and hostname != ''">
            AND tm2.NAME like CONCAT('%',#{hostname},'%')
        </if>
        <if test="no != null and no != ''">
            AND o.no=#{no}
        </if>
        LIMIT #{start}, #{size}
    </select>

    <select id="selectById" resultType="map">
        SELECT
        <include refid="Base_Column_List"/>
        from pk_order o
        left join pk_match m on o.matchid = m.id
        LEFT JOIN pk_team tm ON m.challengeteamid = tm.id
        LEFT JOIN pk_team tm2 ON m.hostteamid = tm2.id
        LEFT JOIN pk_park park ON m.parkid = park.id
        LEFT JOIN areas area ON m.area = area.areaid
        LEFT JOIN dict d on m.time = d.id
        LEFT JOIN pk_park_relation pr on m.time = pr.id
        where o.id=#{id}
    </select>


</mapper>